.row-fluid
  %section.span18.content
    .row-fluid
      .slopel.orange
        .slopelshape
      .row-fluid
        .spacing.highlight
          %h1.pageheader= @channel.title
          -if @live || @upcoming
            .row-fluid
              %article.span24
                .spacing
                  - if @live
                    %h3= t("now_live")
                    %h2= @live.title
                    .row-fluid
                      .span8
                        / .imgmask
                        =link_to [@channel, @live] do
                          - if @live.image
                            =image_tag @live.image.url(:front)
                      .span9
                        =link_to [@channel, @live] do
                          %h2= @live.title

                        %time= l(@live.airdate, :format => :full)
                        .text
                          =smart_truncate(strip_tags(@live.description), :words => 40).html_safe
                          =link_to t("more"), [@channel, @live]

                  - elsif @upcoming

                    .row-fluid
                      .rotate
                        .span8
                          / .imgmask
                          =link_to [@channel, @upcoming] do
                            - if @upcoming.image
                              =image_tag @upcoming.image.url(:front)
                        .span16
                          %h3= t("next_episode")
                          =link_to [@channel, @upcoming] do
                            %h2= @upcoming.title
                          %time= l(@upcoming.airdate, :format => :full)
                          .text
                            =smart_truncate(strip_tags(@upcoming.description), :words => 40).html_safe
                            =link_to t("more"), [@channel, @upcoming]
        .sloper.orange
          .slopershape
    .row-fluid

      %section.span9.chat
        %article

          .sloper.black
            .slopershape
          .smallspacing
            %h2 Chat mee
            %ul#chatBox
              -if @channel.messages.present?
                = render @channel.messages

            .chatForm
              =form_for [@channel, Message.new], :remote => true do |f|
                - unless current_user
                  =f.text_field :name
                  =f.email_field :email
                =f.text_field :content, :id => "new_message"
                =f.submit "Send"
          .slopel.black
            .slopelshape


      %section.span15.challenges
        .sloper.black
          .slopershape
        .smallspacing
          %article
            %h2= t("challenges")
            %p Sed posuere consectetur est at porta ac consectetur ac, vestibulum at eros. Sed posuere consectetur est at lobortis. Nulla vitae elit libero, a pharetra augue. Meer informatie kun je vinden bij Karma & Rewards
            %ul
              - @channel.challenges.each do |challenge|
                %li=link_to challenge.title, [@channel, challenge]

            =link_to  t("post_idea"), [:new, @channel, :idea], :class => "btn"
      .row-fluid
        .span24
          .row-fluid
            .span24
              .spacing
                %section.span12
                  %h2 Changemaker Blogspots
                  %ul.itemlist
                    - @posts.each do |post|
                      %li
                        .row-fluid
                          %article.span24
                            .row-fluid
                              =link_to [@channel, post] do
                                %h3=smart_truncate(strip_tags( post.title), :words => 5).html_safe
                              %time= l(post.updated_at, :format => :short)
                            =link_to [@channel, post] do
                              %img.span6{:src => "http://placehold.it/110x60"}
                            .span16
                              .smallspacing.text
                                =smart_truncate(strip_tags(post.description), :words => 20).html_safe
                                =link_to t("more"), [@channel, post]



                %section.span12
                  %h2 Ingezonden ideeÃ«n
                  %ul.itemlist
                    - @ideas.each do |idea|
                      %li
                        .row-fluid
                          %article.span24
                            .row-fluid
                              =link_to [@channel, idea] do
                                %h3=smart_truncate(strip_tags( idea.title), :words => 5).html_safe
                              %time= l(idea.updated_at, :format => :short)
                            =link_to [@channel, idea] do
                              %img.span6{:src => "http://placehold.it/110x60"}
                            .span16
                              .smallspacing.text
                                =smart_truncate(strip_tags(idea.description), :words => 20).html_safe
                                =link_to t("more"), [@channel, idea]



                .row-fluid
                  %section.span24.laatste_afleveringen_klein
                    %h2 Vorige uitzendingen
                    .row-fluid
                      - @episodes.each do |episode|
                        %article.span7
                          =link_to [@channel, episode] do
                            %h3= episode.title
                          %time= l(episode.airdate, :format => :full)
                          =link_to [@channel, episode] do
                            -if episode.image
                              =image_tag episode.image.url(:front)
                      .span24=link_to "Vorige uitzendingen", [@channel, :episodes], :class => "btn"
  %aside.span6.sidebar
    .sloper.black
      .slopershape
    .spacing
      %section.project-status
        %article
          %h4 Projectstatus
          %p blabla babafsd asdfasdf asd

      %section.over_dit_kanaal
        %article
          %h4= @channel.title
          .text=raw @channel.description

      %section.changemakers
        %article
          %h4 Changemakers
          %img{:src => "http://placehold.it/110x150", :align => 'left'}
          %p Lorem ipsum dolor sit amet, consectetur adi- piscing elit. Vivamus et turpis non mi sagittis rhoncus ac sed nisi. Aliquam et porta elit.
        .row-fluid
        %article
          %h4 Changemakers
          %img{:src => "http://placehold.it/110x150", :align => 'left'}
          %p Lorem ipsum dolor sit amet, consectetur adi- piscing elit. Vivamus et turpis non mi sagittis rhoncus ac sed nisi. Aliquam et porta elit.

      .row-fluid
      %section.links
        %article
          %h4 Aanbevolen links
          %ul
            %li Dit is een link
            %li En nog een link
    .slopel.black
      .slopelshape

- @channel_clean = @channel.id.to_s + @channel.title.downcase.strip.gsub(' ', '-').gsub(/[^\w-]/, '') + "/channel"
:javascript
  $(function(){
    var faye = new Faye.Client('http://localhost:9292/faye');

    faye.subscribe("/#{@channel_clean.to_s}", function(data) {
      eval(data);
    });

  })
  scrollChatbox();