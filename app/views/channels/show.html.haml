.row-fluid
  %section.span18.content
    .row-fluid
      .slopel.orange
        .slopelshape
      .row-fluid
        .spacing.highlight
          %h1.pageheader= @channel.title
          -if @live || @upcoming
            .row-fluid
              %article.span24
                - if @live
                  %h3.clearfix
                    .icon.Episode.white
                    = t("channels.now_live")
                  %h2= @live.title
                  .row-fluid
                    .span8
                      / .imgmask
                      =link_to [@channel, @live] do
                        - if @live.image
                          =image_tag @live.image.url(:front)
                    .span15.offset1
                      =link_to [@channel, @live] do
                        %h2= @live.title

                      -if @live.airdate.present?
                        %time= l(@live.airdate, :format => :full)
                      .text
                        =smart_truncate(strip_tags(@live.description), :words => 40).html_safe
                        =link_to t("more"), [@channel, @live], :class => "btn more pull-right"

                - elsif @upcoming

                  .row-fluid
                    .rotate
                      .span8
                        / .imgmask
                        =link_to [@channel, @upcoming] do
                          - if @upcoming.image
                            =image_tag @upcoming.image.url(:front)
                      .span15.offset1
                        %h3.clearfix
                          .icon.Episode.white
                          = t("channels.next_episode")
                        =link_to [@channel, @upcoming] do
                          %h2= @upcoming.title
                        -if @upcoming.airdate.present?
                          %time= l(@upcoming.airdate, :format => :full)
                        .text
                          =smart_truncate(strip_tags(@upcoming.description), :words => 40).html_safe
                          =link_to t("more"), [@channel, @upcoming], :class => "btn more pull-right"
        .sloper.orange
          .slopershape
    .row-fluid

      %section.span9.chat
        %article

          .sloper.black
            .slopershape
          .spacing
            %h2= t("channels.chat")
            %ul#chatBox
              -if @channel.messages.present?
                = render @channel.messages

            .chatForm.input-append
              =form_for [@channel, Message.new], :remote => true do |f|
                - unless current_user
                  =f.text_field :name
                  =f.email_field :email
                =f.text_field :content, :id => "new_message"
                =f.submit "Send"
          .slopel.black
            .slopelshape


      %section.span15.challenges
        .spacing
          %article
            %h2.clearfix
              .icon.Challenge
              = t("challenges.challenges_and_ideas")
            %p.text Sed posuere consectetur est at porta ac consectetur ac, vestibulum at eros. Sed posuere consectetur est at lobortis. Nulla vitae elit libero, a pharetra augue. Meer informatie kun je vinden bij Karma & Rewards
            .clearfix
              =link_to [:new, @channel, :idea], :class => "btn more iconbtn" do
                .icon.Idea.white
                =t("ideas.new_idea")
            / .row-fluid.challengeindex
            /   .span14= t("challenges.challenge")
            /   .span6= t("challenges.solutions")
            /   .span4= t("challenges.points")
            / %ul.clearfix.itemlist.challenges
            %table.challenges
              %tr
                %th= t("challenges.challenge")
                %th= t("challenges.solutions")
                %th= t("challenges.points")
              - @channel.challenges.each do |challenge|
                %tr
                  %td=link_to challenge.title, [@channel, challenge]
                  %td=link_to challenge.solutions.count, [@channel, challenge]
                  %td= challenge.points

      .row-fluid
        .span24
          .row-fluid
            .span24
              .spacing
                %section.span12
                  %h2
                    .icon.Post
                    = t("articles.articles")
                  %ul.itemlist
                    - @posts.each do |post|
                      %li
                        .row-fluid
                          %article.span24
                            .row-fluid
                              =link_to [@channel, post] do
                                %h3=smart_truncate(strip_tags( post.title), :words => 5).html_safe
                              %time= l(post.updated_at, :format => :short)

                            =link_to [@channel, post] do
                              %img.span7{:src => "http://placehold.it/110x60"}
                            .span16.offset1
                              .text
                                =smart_truncate(strip_tags(post.description), :words => 20).html_safe
                                .clearfix=link_to t("more"), [@channel, post], :class => "btn pull-right more"
                    %li.clearfix=link_to t("articles.all_articles"), [@channel,:posts], :class => "more btn pull-right"



                %section.span12
                  %h2
                    .icon.Idea
                    / %img{:src => "http://placehold.it/50x50"}
                    =t("ideas.submitted")
                  %ul.itemlist
                    - @ideas.each do |idea|
                      %li
                        .row-fluid
                          %article.span24
                            .row-fluid
                              =link_to [@channel, idea] do
                                %h3=smart_truncate(strip_tags( idea.title), :words => 5).html_safe
                              %time= l(idea.updated_at, :format => :short) + " - "
                              %author=link_to idea.user.username, idea.user
                            =link_to [@channel, idea] do
                              / .span7

                            / .span16.offset1
                            -if idea.user.avatar.present?
                              .pull-left=image_tag( idea.user.avatar.url, :style => "width:100px; margin:6px 12px 6px 0;")
                            .text
                              =smart_truncate(strip_tags(idea.description), :words => 20).html_safe
                              .clearfix=link_to t("more"), [@channel, idea], :class => "btn pull-right more"
                    %li.clearfix=link_to t("ideas.all_ideas"), [@channel,:ideas], :class => "more btn pull-right"



                .row-fluid
                  %section.span24.laatste_afleveringen_klein
                    %h2
                      .icon.Episode
                      = t("channels.previous_episodes")
                    .row-fluid
                      - @episodes.each do |episode|
                        %article.span8
                          =link_to [@channel, episode] do
                            %h3= episode.title
                          -if episode.airdate.present?
                            %time= l(episode.airdate, :format => :full)
                          =link_to [@channel, episode] do
                            -if episode.image
                              =image_tag episode.image.url(:front)
                      .span24.smallspacing=link_to t("channels.previous_episodes"), [@channel, :episodes], :class => "btn pull-right more "

  %aside.span6.sidebar
    .sloper.black
      .slopershape
    .spacing
      %section.project-status
        %article
          %h4= t("channels.status")
          %p blabla babafsd asdfasdf asd

      %section.over_dit_kanaal
        %article
          %h4= @channel.title
          .text=raw @channel.description

      %section.changemakers
        %h4= t("channels.changemakers")
        -@channel.admins.each do |changemaker|
          %article.row-fluid.activity
            %h5=link_to changemaker.username, changemaker
            -if changemaker.avatar.present?
              =image_tag changemaker.avatar.url(:portrait)
            -if changemaker.bio
              .text=smart_truncate(strip_tags(changemaker.bio), :words => 20).html_safe

      .row-fluid
      %section.links
        %article
          - if @channel.links.present?
            %h4= t("channels.recommended_links")
            .text=raw @channel.links
    .slopel.black
      .slopelshape

- @channel_clean = @channel.id.to_s + @channel.title.downcase.strip.gsub(' ', '-').gsub(/[^\w-]/, '') + "/channel"
:javascript
  $(function(){
    var faye = new Faye.Client('http://localhost:9292/faye');

    faye.subscribe("/#{@channel_clean.to_s}", function(data) {
      eval(data);
    });

  })
  scrollChatbox();