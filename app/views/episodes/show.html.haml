.spacing.nov=link_to (t("back") + " naar #{@channel.title}"), @channel

.row-fluid
  %section.span18.content
    / %h2= @channel.title
    .row-fluid
      %section.span24.livestream
        .spacing
          .row-fluid
            %article.span24
              %h1.pageheader= @episode.title
              .row-fluid
                .span15
                  %img{:src => "http://placehold.it/850x410"}
                  .row-fluid
                    %article.vraag_stellen
                      .Toggle= t("ask_question")
                      .toggler
                        .orangebg
                          %h3 Stel een vraag

                          =form_for [@episode.channel, @episode, Question.new], :remote => true do |f|
                            - unless current_user
                              =f.text_field :name, :placeholder => "Je naam"
                              =f.text_field :email, :placeholder => "Je E-mail adres"
                            =f.text_field :question, :id => "new_question", :placeholder => "Welke vraag heb jij voor Crowdrevolt?"

                            =f.submit "Stuur vraag in", :class => "btn"

                          -if current_user
                            =form_tag :available, :method => 'post', :remote => true do |f|
                              =check_box_tag :available, :id => "available"
                              =submit_tag "Send"

                        .row-fluid
                          %article.span24.vragen
                            %h3 Onlangs gestelde vragen
                            #questions
                              =render :partial => 'admin/questions/question', :collection => @episode.questions, :as => :question


                .span9.chat
                  .sloper.black
                    .slopershape
                  .smallspacing
                    %h3 Live chat
                    %ul#chatBox
                      -if @episode.messages.present?
                        = render @episode.messages
                    / -= request.original_url + "/messages/new"
                    / = request + "/messages/new"
                    .chatForm
                      =form_for [@episode.channel, @episode, Message.new], :remote => true do |f|
                        =f.text_field :content, :id => "new_message"
                        - unless current_user
                          = f.label :naam
                          =f.text_field :name
                          = f.label :email
                          =f.text_field :email
                        =f.submit "Send"
                  .slopel.black
                    .slopelshape


  %aside.span6.sidebar
    .sloper.black
      .slopershape
    .spacing
      %section.project-status
        %article
          %h4 Projectstatus
          %p blabla babafsd asdfasdf asd

      %section.over_dit_kanaal
        %article
          %h4= t("about_episode")
          .text=raw @episode.description

      %section.changemakers
        %h4= t("channels.changemakers")
        -@channel.admins.each do |changemaker|
          %article.row-fluid.activity
            %h5=link_to changemaker.username, changemaker
            -if changemaker.avatar.present?
              =image_tag changemaker.avatar.url(:portrait)
            -if changemaker.bio
              .text=smart_truncate(strip_tags(changemaker.bio), :words => 20).html_safe

      .row-fluid
      %section.links
        %article
          - if @episode.links.present?
            %h4= t("channels.recommended_links")
            .text=raw @episode.links
    .slopel.black
      .slopelshape



- @episode_clean = @episode.id.to_s + @episode.title.downcase.strip.gsub(' ', '-').gsub(/[^\w-]/, '') + "/episode"
:javascript
  $(function(){
    var faye = new Faye.Client('http://localhost:9292/faye');

    faye.subscribe("/#{@episode_clean.to_s}", function(data) {
      eval(data);
    });

    faye.subscribe("/#{@episode_clean.to_s}/questions", function(data) {
      eval(data);
    });
  })

  $("available").change(function(){
    $(this).closest("form").submit();
  })